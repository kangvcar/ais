
### **`ais`: æ™ºèƒ½ç»ˆç«¯åŠ©æ‰‹ - æœ€ç»ˆæŠ€æœ¯è®¾è®¡è§„æ ¼ä¹¦**

#### **ä¸€ã€ é¡¹ç›®æ ¸å¿ƒåŸåˆ™**

1.  **ä»£ç æç®€**: å§‹ç»ˆé€‰æ‹©èƒ½ç”¨æœ€å°‘ã€æœ€ç›´è§‚ä»£ç å®ç°åŠŸèƒ½çš„æ–¹æ¡ˆã€‚ä¼˜å…ˆä½¿ç”¨é«˜è¡¨è¾¾åŠ›çš„åº“æ¥å‡å°‘æ ·æ¿ä»£ç ã€‚
2.  **ç»“æ„æ¸…æ™°**: é¡¹ç›®ç›®å½•ã€æ¨¡å—åˆ’åˆ†å’Œä»£ç é€»è¾‘åº”æ¸…æ™°æ˜äº†ï¼Œæ˜“äºæ–°å¼€å‘è€…ç†è§£å’Œç»´æŠ¤ã€‚
3.  **ä½“éªŒä¼˜å…ˆ**: æ‰€æœ‰æŠ€æœ¯å†³ç­–æœ€ç»ˆéƒ½åº”æœåŠ¡äºä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæµç•…ã€ç›´è§‚ã€å¯é çš„ç»ˆç«¯ä½“éªŒã€‚
4.  **æ¸è¿›å¼å¼€å‘**: é‡‡ç”¨ MVP æ–¹å¼ï¼Œåˆ†é˜¶æ®µå®ç°åŠŸèƒ½ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½èƒ½ç‹¬ç«‹å·¥ä½œã€‚
5.  æ¯ä¸ªé˜¶æ®µæ€§çš„ä¿®æ”¹éƒ½éœ€è¦æäº¤git ç‰ˆæœ¬æ§åˆ¶å¹¶å†™æ¸…æ¥šè¯¦ç»†çš„commitã€‚
6.  ä½¿ç”¨æœ€ä½³å®è·µè¿›è¡Œå¼€å‘ï¼Œä½¿ç”¨æœ€å°‘çš„ä»£ç é‡Œã€‚

#### **äºŒã€ é¡¹ç›®ç»“æ„è®¾è®¡**

...

#### **ä¸‰ã€ å¼€å‘é˜¶æ®µè§„åˆ’**

**é˜¶æ®µ 1: åŸºç¡€ CLI æ¡†æ¶ (MVP)**
- å®ç° `ais` å‘½ä»¤è¡Œå…¥å£ç‚¹
- åŸºç¡€çš„ AI å¯¹è¯åŠŸèƒ½ (`ais ask "é—®é¢˜"`)
- é…ç½®æ–‡ä»¶ç®¡ç† (`ais config`)
- åŸºç¡€çš„å¼€å…³æ§åˆ¶ (`ais on/off`)

**é˜¶æ®µ 2: é…ç½®ä¸æŒä¹…åŒ–**
- å®Œå–„é…ç½®æ–‡ä»¶ç»“æ„å’Œç®¡ç†
- å®ç°å¤š AI æœåŠ¡æä¾›å•†æ”¯æŒ
- åŸºç¡€çš„æ•°æ®åº“å­˜å‚¨

**é˜¶æ®µ 3: é”™è¯¯æ•è·æœºåˆ¶**
- å®ç° shell é›†æˆè„šæœ¬
- ä¼˜åŒ–çš„é”™è¯¯æ•è·ç­–ç•¥ï¼ˆä½¿ç”¨ PROMPT_COMMAND è€Œé trap ERRï¼‰
- ä¸Šä¸‹æ–‡æ”¶é›†ç³»ç»Ÿ

**é˜¶æ®µ 4: æ™ºèƒ½åˆ†æä¸äº¤äº’**
- AI é”™è¯¯åˆ†æåŠŸèƒ½
- äº¤äº’å¼å»ºè®®èœå•
- æµå¼è¾“å‡ºæ”¯æŒ

**é˜¶æ®µ 5: å®‰è£…ä¸åˆ†å‘**
- å®Œå–„å®‰è£…è„šæœ¬
- æ‰“åŒ…å’Œåˆ†å‘æœºåˆ¶

#### **å››ã€ å®‰è£…ä¸åˆå§‹åŒ–**

1.  **ä¸€é”®å®‰è£…è„šæœ¬**: ç”¨æˆ·é€šè¿‡å•ä¸€å‘½ä»¤å®Œæˆå®‰è£…ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

    ```bash
    curl -sSL https://ais-cli.com/install.sh | bash
    ```

2.  **`install.sh` è„šæœ¬èŒè´£**:

      * **ç¯å¢ƒæ£€æŸ¥**: éªŒè¯ç³»ç»Ÿæ˜¯å¦å·²å®‰è£… `python` å’Œ `pip`ã€‚
      * **å®‰è£… `uv`**: å¦‚æœ `uv` ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•å®‰è£…å®ƒã€‚
      * **å®‰è£… `ais`**: ä½¿ç”¨ `uv pip install ais-cli` ä»PyPIï¼ˆæˆ–å…¶ä»–æºï¼‰å®‰è£…`ais`åŒ…ã€‚
      * **Shellé…ç½®æ³¨å…¥**:
          * è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·çš„Shellé…ç½®æ–‡ä»¶ï¼ˆ`~/.bashrc`, `~/.zshrc`ï¼‰ã€‚
          * å‘é…ç½®æ–‡ä»¶ä¸­è¿½åŠ ä¸€æ®µç”±æ˜ç¡®æ ‡è®°åŒ…å›´çš„è„šæœ¬ï¼Œä»¥ä¾¿äºæœªæ¥æ›´æ–°æˆ–å¸è½½ã€‚ä¾‹å¦‚ï¼š
            ```bash
            # START AIS INTEGRATION
            # This block is managed by ais-cli. Do not edit manually.
            source "/path/to/ais/shell/integration.sh"
            # END AIS INTEGRATION
            ```
      * **æç¤ºç”¨æˆ·**: å®‰è£…å®Œæˆåï¼Œæç¤ºç”¨æˆ·éœ€æ‰§è¡Œ `source ~/.bashrc` æˆ–é‡å¯ç»ˆç«¯ä»¥ä½¿é…ç½®ç”Ÿæ•ˆã€‚

3.  **é›¶é…ç½®å¯åŠ¨**: ç¨‹åºå†…ç½®é»˜è®¤APIé…ç½®ï¼Œç¡®ä¿å¼€ç®±å³ç”¨ã€‚

      * **é»˜è®¤ç«¯ç‚¹**: `https://api.deepbricks.ai/v1/chat/completions`
      * **é»˜è®¤æ¨¡å‹**: `gpt-4o-mini`
      * **é»˜è®¤å¯†é’¥**: `sk-97RxyS9R2dsqFTUxcUZOpZwhnbjQCSOaFboooKDeTv5nHJgg`

#### **äº”ã€ åŠŸèƒ½æ¨¡å—è¯¦è¿°**

1.  **Shellæ·±åº¦é›†æˆ (`integration.sh`)** - ä¼˜åŒ–ç‰ˆæœ¬:

      * **é”™è¯¯æ•è·æœºåˆ¶**: ä½¿ç”¨ `PROMPT_COMMAND` è€Œé `trap ERR`ï¼Œé¿å…ä¸å…¶ä»–å·¥å…·å†²çªã€‚
        ```bash
        # åœ¨ integration.sh ä¸­
        _ais_last_command=""
        _ais_last_exit_code=0
        
        _ais_preexec() {
          _ais_last_command="$1"
        }
        
        _ais_precmd() {
          _ais_last_exit_code=$?
          
          # åªå¤„ç†éé›¶é€€å‡ºç ä¸”éä¸­æ–­ä¿¡å·
          if [ $_ais_last_exit_code -ne 0 ] && [ $_ais_last_exit_code -ne 130 ]; then
            # æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¼€å¯
            if grep -q "auto_analysis = true" ~/.config/ais/config.toml 2>/dev/null; then
              # å¼‚æ­¥è°ƒç”¨åˆ†æï¼Œé¿å…é˜»å¡ç”¨æˆ·æ“ä½œ
              ais _analyze --exit-code $_ais_last_exit_code --command "$_ais_last_command" &
            fi
          fi
        }
        
        # æ ¹æ®ä¸åŒ shell è®¾ç½®é’©å­
        if [ -n "$ZSH_VERSION" ]; then
          autoload -U add-zsh-hook
          add-zsh-hook preexec _ais_preexec
          add-zsh-hook precmd _ais_precmd
        elif [ -n "$BASH_VERSION" ]; then
          trap '_ais_preexec "$BASH_COMMAND"' DEBUG
          PROMPT_COMMAND="_ais_precmd;$PROMPT_COMMAND"
        fi
        ```
      * **è‡ªåŠ¨åˆ†æå¼€å…³**:
          * æä¾› `ais on` å’Œ `ais off` å‘½ä»¤ã€‚
          * è¿™ä¸¤ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ `~/.config/ais/config.toml` æ–‡ä»¶ä¸­çš„ `auto_analysis` å¸ƒå°”å€¼ã€‚
          * é›†æˆè„šæœ¬ä¼šæ£€æŸ¥é…ç½®æ–‡ä»¶çŠ¶æ€æ¥å†³å®šæ˜¯å¦å¯ç”¨åˆ†æã€‚

2.  **æ™ºèƒ½ä¸Šä¸‹æ–‡æ”¶é›†** - ä¼˜åŒ–ç‰ˆæœ¬:
    `ais _analyze` å‘½ä»¤è¢«è§¦å‘åï¼Œé‡‡ç”¨åˆ†çº§æ”¶é›†ç­–ç•¥ï¼š

      * **æ ¸å¿ƒçº§åˆ«** (æ€»æ˜¯æ”¶é›†):
          * é”™è¯¯å‘½ä»¤å’Œé€€å‡ºç 
          * æ ‡å‡†é”™è¯¯è¾“å‡º
          * å½“å‰å·¥ä½œç›®å½•
      
      * **æ ‡å‡†çº§åˆ«** (é»˜è®¤æ”¶é›†):
          * æœ€è¿‘ 10 æ¡å‘½ä»¤å†å² (è€Œé 20 æ¡)
          * å½“å‰ç›®å½•æ–‡ä»¶åˆ—è¡¨ (ä»…æ–‡ä»¶åï¼Œä¸å«è¯¦ç»†ä¿¡æ¯)
          * Git çŠ¶æ€ (å¦‚æœæ˜¯ Git ä»“åº“)
      
      * **è¯¦ç»†çº§åˆ«** (å¯é…ç½®):
          * ç³»ç»Ÿä¿¡æ¯ (`uname -a`)
          * ç¯å¢ƒå˜é‡ç›¸å…³ä¿¡æ¯
          * å®Œæ•´çš„ `ls -la` è¾“å‡º
      
      * **å®‰å…¨è¿‡æ»¤**:
          * æ’é™¤åŒ…å«å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯çš„ä¸Šä¸‹æ–‡
          * æä¾›æ•æ„Ÿç›®å½•é»‘åå•é…ç½® (å¦‚ ~/.ssh, ~/.config)
          * å¯¹è¾“å‡ºè¿›è¡Œè„±æ•å¤„ç†

3.  **AIäº¤äº’åè®®** - å¢å¼ºç‰ˆæœ¬:

      * **è¯·æ±‚**: System Promptå¿…é¡»æ˜ç¡®æŒ‡ç¤ºAIæ‰®æ¼”ä¸€ä¸ªLinux/macOSå‘½ä»¤è¡Œä¸“å®¶ï¼Œå¹¶ä¸”**å¿…é¡»**ä»¥æŒ‡å®šçš„JSONæ ¼å¼è¿”å›å“åº”ã€‚
      * **å“åº”å®¹é”™å¤„ç†**: 
          * ä¸»è¦è§£ææ ‡å‡† JSON æ ¼å¼
          * å¦‚æœ JSON è§£æå¤±è´¥ï¼Œå°è¯•ä» Markdown ä»£ç å—ä¸­æå–
          * æä¾›é™çº§å¤„ç†ï¼šçº¯æ–‡æœ¬è§£é‡Š + ç©ºå»ºè®®åˆ—è¡¨
      * **å“åº” (JSONç»“æ„)**: AIçš„è¿”å›**å¿…é¡»**ä¸¥æ ¼éµå®ˆä»¥ä¸‹ç»“æ„ï¼š
        ```json
        {
          "explanation": "è¿™é‡Œæ˜¯å¯¹é”™è¯¯çš„è¯¦ç»†åˆ†æã€åŸå› è¯´æ˜å’ŒèƒŒæ™¯çŸ¥è¯†æ™®åŠã€‚å¯ä»¥ä½¿ç”¨Markdownè¯­æ³•ï¼Œä¾‹å¦‚ `ä»£ç å—` æˆ– **åŠ ç²—**ã€‚",
          "suggestions": [
            {
              "description": "ä¿®æ­£è¯¥æ‹¼å†™é”™è¯¯ï¼Œå¹¶æ£€æŸ¥ä»“åº“çŠ¶æ€ã€‚",
              "command": "git status",
              "risk_level": "safe"  // æ–°å¢: safe, moderate, dangerous
            },
            {
              "description": "å¦‚æœæƒ³æš‚å­˜å½“å‰å˜æ›´ï¼Œä½¿ç”¨æ­¤å‘½ä»¤ã€‚",
              "command": "git stash",
              "risk_level": "safe"
            }
          ]
        }
        ```

4.  **ç”¨æˆ·äº¤äº’æµç¨‹** - å¢å¼ºç‰ˆæœ¬:

      * **æµå¼æ¸²æŸ“**: `explanation` å­—æ®µä½¿ç”¨ `rich.markdown.Markdown` è¿›è¡Œæµå¼æ¸²æŸ“ã€‚
      * **å¢å¼ºäº¤äº’èœå•**: ä½¿ç”¨ `questionary` åº“ç”Ÿæˆï¼ŒåŒ…å«é£é™©çº§åˆ«æ˜¾ç¤ºï¼š
        ```
        ğŸ¤– AI Analysis Complete
        
        [é”™è¯¯åˆ†æå†…å®¹ä»¥æµå¼æ–¹å¼æ˜¾ç¤º]
        
        ? Select an action: 
          â–¸ 1. git status              âœ… (ä¿®æ­£è¯¥æ‹¼å†™é”™è¯¯ï¼Œå¹¶æ£€æŸ¥ä»“åº“çŠ¶æ€ã€‚)
            2. git stash               âœ… (å¦‚æœæƒ³æš‚å­˜å½“å‰å˜æ›´ï¼Œä½¿ç”¨æ­¤å‘½ä»¤ã€‚)
            3. rm -rf /                âš ï¸  (å±é™©æ“ä½œï¼Œè¯·è°¨æ…ï¼)
            ---------------------------------------------------------------------------
            4. Edit a command...
            5. Ask follow-up question
            6. Exit
        ```
      * **å‘½ä»¤æ‰§è¡Œç¡®è®¤**: å¯¹äº `dangerous` çº§åˆ«çš„å‘½ä»¤ï¼Œè¦æ±‚ç”¨æˆ·äºŒæ¬¡ç¡®è®¤ã€‚
      * **æ‰§è¡Œåé¦ˆ**: å‘½ä»¤æ‰§è¡Œåæ˜¾ç¤ºç»“æœï¼Œå¹¶è¯¢é—®æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ã€‚

#### **å…­ã€ æ•°æ®ä¸é…ç½®æŒä¹…åŒ–**

1.  **é…ç½®æ–‡ä»¶** - å¢å¼ºç‰ˆæœ¬:

      * **è·¯å¾„**: `~/.config/ais/config.toml`
      * **å®Œæ•´ç»“æ„ç¤ºä¾‹**:
        ```toml
        # é»˜è®¤ä½¿ç”¨çš„AIæœåŠ¡æä¾›å•†çš„åç§°
        default_provider = "default_free"

        # è‡ªåŠ¨é”™è¯¯åˆ†æåŠŸèƒ½çš„å¼€å…³
        auto_analysis = true

        # ä¸Šä¸‹æ–‡æ”¶é›†çº§åˆ«: minimal, standard, detailed
        context_level = "standard"

        # æ•æ„Ÿç›®å½•é»‘åå•
        sensitive_dirs = ["~/.ssh", "~/.config/ais", "~/.aws"]

        # UI è®¾ç½®
        [ui]
        enable_colors = true
        enable_streaming = true
        max_history_display = 10

        # é¢„ç½®çš„å…è´¹æœåŠ¡
        [providers.default_free]
        base_url = "https://api.deepbricks.ai/v1/chat/completions"
        model_name = "gpt-4o-mini"
        api_key = "sk-97RxyS9R2dsqFTUxcUZOpZwhnbjQCSOaFboooKDeTv5nHJgg"

        # ç”¨æˆ·è‡ªå®šä¹‰çš„OllamaæœåŠ¡
        [providers.my_ollama]
        base_url = "http://localhost:11434/v1"
        model_name = "llama3"
        # api_key is not needed for local ollama

        # ç”¨æˆ·è‡ªå®šä¹‰çš„OpenAIæœåŠ¡
        [providers.my_openai]
        # base_url is optional, defaults to official
        model_name = "gpt-4o"
        # api_key will be read from environment variable OPENAI_API_KEY
        
        # é«˜çº§è®¾ç½®
        [advanced]
        max_context_length = 4000  # å‘é€ç»™AIçš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦
        async_analysis = true      # å¼‚æ­¥åˆ†æä»¥é¿å…é˜»å¡
        cache_analysis = true      # ç¼“å­˜ç›¸ä¼¼é”™è¯¯çš„åˆ†æç»“æœ
        ```

2.  **æœ¬åœ°æ•°æ®åº“**:

      * **è·¯å¾„**: `~/.local/share/ais/history.db`
      * **æŠ€æœ¯**: SQLite + `SQLModel`
      * **`CommandLog` è¡¨ç»“æ„å­—æ®µ**:
          * `id`: INTEGER, PRIMARY KEY
          * `timestamp`: DATETIME
          * `username`: TEXT
          * `original_command`: TEXT
          * `stderr_output`: TEXT
          * `context_json`: TEXT (å­˜å‚¨æ”¶é›†åˆ°çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„JSONå­—ç¬¦ä¸²)
          * `ai_explanation`: TEXT
          * `ai_suggestions_json`: TEXT (å­˜å‚¨AIè¿”å›çš„suggestionsåˆ—è¡¨çš„JSONå­—ç¬¦ä¸²)
